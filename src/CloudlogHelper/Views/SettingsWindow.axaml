<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:resources="clr-namespace:CloudlogHelper.Resources"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        x:Class="CloudlogHelper.Views.SettingsWindow"
        xmlns:viewModels="clr-namespace:CloudlogHelper.ViewModels"
        xmlns:userControls1="clr-namespace:CloudlogHelper.Views.UserControls"
        xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:avaloniaProgressRing="clr-namespace:AvaloniaProgressRing;assembly=AvaloniaProgressRing"
        mc:Ignorable="d"
        d:DesignWidth="700" d:DesignHeight="700"
        x:DataType="viewModels:SettingsWindowViewModel"
        Title="{I18N {x:Static resources:LangKeys.settings}}"
        SizeToContent="Width"
        CanResize="False"
        Icon="avares://CloudlogHelper/Assets/icon.png"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI">

    <Design.DataContext>
        <viewModels:SettingsWindowViewModel />
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="Border.setting-card">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlBackgroundChromeMediumBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0 0 0 16" />
            <Setter Property="BoxShadow" Value="0 2 4 0 DarkGray" />
        </Style>

        <Style Selector="TextBlock.section-title">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0 0 0 8" />
        </Style>

        <Style Selector="TextBlock.setting-label">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="0 0 12 0" />
            <Setter Property="MinWidth" Value="140" />
        </Style>

        <Style Selector="ComboBox.setting-control, TextBox.setting-control">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Width" Value="200" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="Button.primary-action">
            <Setter Property="Background" Value="{DynamicResource SystemControlHighlightAccent3RevealBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="16 8" />
            <Setter Property="MinWidth" Value="120" />
        </Style>

        <Style Selector="Button.secondary-action">
            <Setter Property="Background" Value="{DynamicResource NotificationCardErrorBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="16 8" />
            <Setter Property="MinWidth" Value="120" />
        </Style>

        <Style Selector="Border.subsection-card">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorderMidBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundChromeMediumBrush}" />
        </Style>

        <Style Selector="TextBlock.subsection-title">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Margin" Value="0 0 0 4" />
        </Style>

        <Style Selector="TabItem">
            <Setter Property="Padding" Value="12 8" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style Selector="TabStrip">
            <Setter Property="Margin" Value="0 0 0 16" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*,Auto" Margin="16" IsEnabled="{Binding FullyInitialized}">
        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center" Margin="0 0 0 16">
            <avaloniaProgressRing:ProgressRing
                Width="20"
                Height="20"
                IsVisible="{Binding !FullyInitialized}"
                Foreground="{DynamicResource SystemControlHighlightAccentBrush}" />
            <Image Width="32" Height="32" Source="avares://CloudlogHelper/Assets/icon.png" IsVisible="{Binding FullyInitialized}"/>
            <TextBlock Text="{I18N {x:Static resources:LangKeys.settings}}" FontSize="24" FontWeight="Bold" />
        </StackPanel>

        <!-- Main Content (TabControl) -->
        <TabControl Grid.Row="1" MaxWidth="750">
            <!-- Basic Settings Tab -->
            <TabItem Header="{I18N {x:Static resources:LangKeys.basicsettings}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{I18N {x:Static resources:LangKeys.instancename}}" Classes="setting-label" />
                            <TextBox HorizontalAlignment="Left"
                                     Text="{Binding DraftSettings.InstanceName}"
                                     Classes="setting-control"/>
                            <userControls1:TipIconUserControl 
                                Margin="10,0,0,0" TooltipText="{I18N {x:Static resources:LangKeys.instancenamehint}}"/>
                        </StackPanel>
                        <StackPanel Spacing="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Language/语言" Classes="setting-label" />
                                <ComboBox Classes="setting-control"
                                          ItemsSource="{Binding LanguageInfos}"
                                          SelectedValueBinding="{Binding Language}"
                                          SelectedValue="{Binding DraftSettings.BasicSettings.LanguageType}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding LanguageName}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{I18N {x:Static resources:LangKeys.mygrid}}" Classes="setting-label" />
                                <TextBox HorizontalAlignment="Left"
                                         Text="{Binding DraftSettings.BasicSettings.MyMaidenheadGrid}"
                                         Classes="setting-control"
                                         Watermark="e.g. OM89" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                                <CheckBox HorizontalAlignment="Left" Height="20"
                                          Content="{I18N {x:Static resources:LangKeys.disablecharts}}"
                                          IsChecked="{Binding DraftSettings.BasicSettings.DisableAllCharts}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="15">
                                <Button Content="{I18N {x:Static resources:LangKeys.openconfpath}}"
                                        Command="{Binding OpenConfDir}" />

                                <Button Content="{I18N {x:Static resources:LangKeys.opentempfolder}}"
                                        Command="{Binding OpenTempDir}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="15">
                                <Button Content="{I18N {x:Static resources:LangKeys.updatebigcty}}"
                                        Command="{Binding UpdateBigCty}" />
                                <userControls1:TipIconUserControl TooltipText="{I18N {x:Static resources:LangKeys.bigctyhint}}"/>
                            </StackPanel>
                        </StackPanel>
                        <!-- </Border> -->
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <!-- Cloudlog Tab -->
            <TabItem Header="Cloudlog">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <Grid ColumnDefinitions="*,2*,*" RowDefinitions="Auto,Auto,Auto,Auto"
                                      ShowGridLines="False"
                                      RowSpacing="10">
                                    <!-- URL -->
                                    <TextBlock Text="Cloudlog URL" Classes="setting-label" Grid.Row="0" Grid.Column="0" />
                                    <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="1" Spacing="8">
                                        <TextBox Classes="setting-control"
                                                 Text="{Binding DraftSettings.CloudlogSettings.CloudlogUrl}"
                                                 Watermark="{I18N {x:Static resources:LangKeys.urlexample}}" />
                                        <userControls1:TipIconUserControl
                                            TooltipText="{I18N {x:Static resources:LangKeys.cloudlogurlhelp}}" />
                                    </StackPanel>
                                    <userControls1:TestButtonUserControl Grid.Row="0" Grid.RowSpan="2" Grid.Column="2"
                                                                         DataContext="{Binding CloudlogTestButtonUserControl}" />

                                    <!-- API Key -->
                                    <TextBlock Text="Cloudlog APIKey" Classes="setting-label" Grid.Row="1"
                                               Grid.Column="0" />
                                    <StackPanel Orientation="Horizontal" Grid.Row="1" Grid.Column="1" Spacing="8">
                                        <TextBox Classes="setting-control"
                                                 Text="{Binding DraftSettings.CloudlogSettings.CloudlogApiKey}" />
                                        <userControls1:TipIconUserControl
                                            TooltipText="{I18N {x:Static resources:LangKeys.cloudlogapihelp}}" />
                                    </StackPanel>

                                    <!-- Station ID -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.stationid}}"
                                               Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0"
                                               IsVisible="{Binding ShowCloudlogStationIdCombobox}" />
                                    <StackPanel Orientation="Horizontal" Grid.Row="2" Grid.Column="1" Spacing="8"
                                                IsVisible="{Binding ShowCloudlogStationIdCombobox}">
                                        <ComboBox Classes="setting-control"
                                                  PlaceholderText="{I18N {x:Static resources:LangKeys.psesel}}"
                                                  ItemsSource="{Binding DraftSettings.CloudlogSettings.AvailableCloudlogStationInfo}"
                                                  SelectedValue="{Binding DraftSettings.CloudlogSettings.CloudlogStationInfo}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding StationId}" />
                                                        <TextBlock
                                                            Text="{Binding StationProfileName, StringFormat=' ({0})'}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                        <userControls1:TipIconUserControl
                                            TooltipText="{I18N {x:Static resources:LangKeys.cloudlogstationid}}" />
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Grid.Row="3" Grid.Column="0"
                                                Grid.ColumnSpan="2" Spacing="20">
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.autoqsoupload}}"
                                                  IsChecked="{Binding DraftSettings.CloudlogSettings.AutoQSOUploadEnabled}" />
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.autorigupload}}"
                                                  IsChecked="{Binding DraftSettings.CloudlogSettings.AutoRigUploadEnabled}" />
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.autopollstatus}}"
                                                  IsChecked="{Binding DraftSettings.CloudlogSettings.AutoPollStationStatus}" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Third-party Log Systems Tab -->
            <TabItem Header="{I18N {x:Static resources:LangKeys.thirdpartylogsys}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <Border Classes="setting-card">
                            <userControls1:LogSystemCard DataContext="{Binding }" />
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Rig Control Tab -->
            <TabItem Header="{I18N {x:Static resources:LangKeys.rigbackendsystem}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <!-- HamLib Settings -->
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <StackPanel>
                                    <TextBlock Text="HamLib" Classes="section-title" />
                                </StackPanel>
                                
                                <Border BorderBrush="Transparent"  IsVisible="{Binding !HamlibInited}"  CornerRadius="5" Background="DarkOrange" Padding="10">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20">
                                        <avalonia:MaterialIcon Kind="Warning" Width="20" Height="20"
                                                               VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,8,0" />
                                        <TextBlock 
                                            VerticalAlignment="Center"
                                            FontWeight="Heavy"
                                            TextAlignment="Center"
                                            FontSize="14"
                                            Width="360"
                                            TextWrapping="Wrap"
                                            Text="{I18N {x:Static resources:LangKeys.inithamlibfailed}}" />
                                    </StackPanel>
                                </Border>

                                <Grid IsEnabled="{Binding HamlibInited}" ColumnDefinitions="*,2*,*"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ShowGridLines="False"
                                      RowSpacing="10">
                                    <!-- Polling -->
                                    <CheckBox Content="{I18N {x:Static resources:LangKeys.autoupdateriginfo}}"
                                              Grid.Column="0" Grid.ColumnSpan="2"
                                              IsChecked="{Binding DraftSettings.HamlibSettings.PollAllowed}" />

                                    <!-- Poll Interval -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.pollinterval}}"
                                               Classes="setting-label"
                                               Grid.Row="1" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="1" Grid.Column="1"
                                             HorizontalAlignment="Left"
                                             MinWidth="20" Width="80"
                                             Text="{Binding DraftSettings.HamlibSettings.PollInterval}" />

                                    <!-- Rig Model -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.rigmodel}}"
                                               Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0" />
                                    <ComboBox Classes="setting-control" Grid.Row="2" Grid.Column="1"
                                              DisplayMemberBinding="{Binding Model}"
                                              SelectedItem="{Binding DraftSettings.HamlibSettings.SelectedRigInfo}"
                                              ItemsSource="{Binding SupportedModels}" />

                                    <!-- Device Port -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.deviceport}}"
                                               Classes="setting-label"
                                               Grid.Row="3" Grid.Column="0"
                                               IsEnabled="{Binding !#externalRigctld.IsChecked}" />
                                    <StackPanel Orientation="Horizontal" Grid.Row="3" Grid.Column="1" Spacing="8"
                                                IsEnabled="{Binding !#externalRigctld.IsChecked}">
                                        <ComboBox Classes="setting-control"
                                                  IsEditable="True"
                                                  Text="{Binding DraftSettings.HamlibSettings.SelectedPort}"
                                                  ItemsSource="{Binding Ports}" />
                                        <Button Command="{Binding RefreshPort}" CornerRadius="4"
                                                Content="{avalonia:MaterialIconExt Kind=Refresh}"
                                                Width="32" Height="32" />
                                    </StackPanel>

                                    <!-- Report Options -->
                                    <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                                Orientation="Horizontal"
                                                Spacing="24">
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.reportsplit}}"
                                                  IsChecked="{Binding DraftSettings.HamlibSettings.ReportSplitInfo}" />
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.reportpwr}}"
                                                  IsChecked="{Binding DraftSettings.HamlibSettings.ReportRFPower}" />
                                    </StackPanel>

                                    <!-- Advanced Settings -->
                                    <Expander Header="{I18N {x:Static resources:LangKeys.advancedsettings}}"
                                              Grid.Row="5"
                                              Grid.Column="0" Grid.ColumnSpan="3">
                                        <StackPanel Spacing="12" Margin="0 12 0 0">
                                            <Grid ColumnDefinitions="Auto,*,Auto" Margin="0 0 0 0">
                                                <TextBlock Text="{I18N {x:Static resources:LangKeys.syncrigto}}"
                                                           Classes="setting-label" />
                                                <TextBox Classes="setting-control" Grid.Column="1"
                                                         Text="{Binding DraftSettings.HamlibSettings.SyncRigInfoAddress}"
                                                         Watermark="e.g. http://a.com/b;https://b.com/c" />
                                                <userControls1:TipIconUserControl Grid.Column="2" TooltipText="{I18N {x:Static resources:LangKeys.spiltby}}" />
                                            </Grid>

                                            <CheckBox Content="{I18N {x:Static resources:LangKeys.enableadvanced}}"
                                                      x:Name="advancedRig"
                                                      IsChecked="{Binding DraftSettings.HamlibSettings.UseRigAdvanced}" />

                                            <StackPanel Spacing="12" Margin="24 0 0 0"
                                                        IsEnabled="{Binding #advancedRig.IsChecked}">
                                                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto"
                                                      ShowGridLines="False" RowSpacing="10" ColumnSpacing="10">
                                                    <TextBlock
                                                        Text="{I18N {x:Static resources:LangKeys.rigctldcmdarg}}"
                                                        Classes="setting-label" />
                                                    <TextBox Classes="setting-control" Grid.Row="0" Grid.Column="1"
                                                             Text="{Binding DraftSettings.HamlibSettings.OverrideCommandlineArg}" />

                                                    <CheckBox Grid.Row="1"
                                                              Content="{I18N {x:Static resources:LangKeys.disableptt}}"
                                                              Grid.ColumnSpan="2" Grid.Column="0"
                                                              IsChecked="{Binding DraftSettings.HamlibSettings.DisablePTT}" />

                                                    <CheckBox Grid.Row="1" Grid.Column="1"
                                                              Content="{I18N {x:Static resources:LangKeys.allowexternalcontrol}}"
                                                              IsChecked="{Binding DraftSettings.HamlibSettings.AllowExternalControl}" />
                                                </Grid>
                                            </StackPanel>

                                            <CheckBox Content="{I18N {x:Static resources:LangKeys.useexternalrigctld}}"
                                                      x:Name="externalRigctld"
                                                      IsChecked="{Binding DraftSettings.HamlibSettings.UseExternalRigctld}" />

                                            <Grid ColumnDefinitions="Auto,*" Margin="24 0 0 0"
                                                  IsEnabled="{Binding #externalRigctld.IsChecked}">
                                                <TextBlock
                                                    Text="{I18N {x:Static resources:LangKeys.externalrigctldhost}}"
                                                    Classes="setting-label" />
                                                <TextBox Classes="setting-control" Grid.Column="1"
                                                         Text="{Binding DraftSettings.HamlibSettings.ExternalRigctldHostAddress}" />
                                            </Grid>
                                            <TextBlock Text="{Binding HamlibVersion}" Margin="0 5 0 0"
                                                       FontStyle="Italic" />
                                        </StackPanel>
                                    </Expander>

                                    <userControls1:TestButtonUserControl Grid.Row="0" Grid.Column="2" Grid.RowSpan="4"
                                                                         DataContext="{Binding HamlibTestButtonUserControl}" />
                                </Grid>
                                <!-- <TextBlock Text="{I18N {x:Static resources:LangKeys.testandapply}}" Margin="0 12 0 0" -->
                                <!--            FontStyle="Normal" FontSize="10" FontWeight="Black" /> -->
                            </StackPanel>
                        </Border>

                        <!-- FLRig Settings -->
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <TextBlock Text="FLRig" Classes="section-title" />

                                <Grid ColumnDefinitions="*,2*,*"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ShowGridLines="False"
                                      RowSpacing="10">
                                    <!-- Polling -->
                                    <CheckBox Content="{I18N {x:Static resources:LangKeys.autoupdateriginfo}}"
                                              Grid.Column="0" Grid.ColumnSpan="2"
                                              IsChecked="{Binding DraftSettings.FLRigSettings.PollAllowed}" />

                                    <!-- Poll Interval -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.pollinterval}}"
                                               Classes="setting-label"
                                               Grid.Row="1" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="1" Grid.Column="1"
                                             HorizontalAlignment="Left"
                                             MinWidth="20" Width="80"
                                             Text="{Binding DraftSettings.FLRigSettings.PollInterval}" />

                                    <!-- flrig ip-->
                                    <TextBlock Text="FLRig IP" Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="2" Grid.Column="1"
                                             HorizontalAlignment="Left"
                                             MinWidth="20" Width="120"
                                             Text="{Binding DraftSettings.FLRigSettings.FLRigHost}" />

                                    <!-- flrig port-->
                                    <TextBlock Text="FLRig Port" Classes="setting-label"
                                               Grid.Row="3" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="3" Grid.Column="1"
                                             HorizontalAlignment="Left"
                                             MinWidth="20" Width="120"
                                             Text="{Binding DraftSettings.FLRigSettings.FLRigPort}" />

                                    <!-- Report Options -->
                                    <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                                Orientation="Horizontal"
                                                Spacing="24">
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.reportsplit}}"
                                                  IsChecked="{Binding DraftSettings.FLRigSettings.ReportSplitInfo}" />
                                        <CheckBox Content="{I18N {x:Static resources:LangKeys.reportpwr}}"
                                                  IsChecked="{Binding DraftSettings.FLRigSettings.ReportRFPower}" />
                                    </StackPanel>

                                    <Grid Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*,Auto"
                                          Margin="0 0 0 0" ColumnSpacing="10">
                                        <TextBlock Text="{I18N {x:Static resources:LangKeys.syncrigto}}"
                                                   Classes="setting-label" />
                                        <TextBox Classes="setting-control" Grid.Column="1"
                                                 Text="{Binding DraftSettings.FLRigSettings.SyncRigInfoAddress}"
                                                 Watermark="e.g. http://a.com/b;https://b.com/c" />
                                        <userControls1:TipIconUserControl Grid.Column="2" TooltipText="{I18N {x:Static resources:LangKeys.spiltby}}" />
                                    </Grid>

                                    <userControls1:TestButtonUserControl Grid.Row="0" Grid.Column="2" Grid.RowSpan="4"
                                                                         DataContext="{Binding FLRigTestButtonUserControl}" />
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- OmniRig Settings -->
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <TextBlock Text="OmniRig" Classes="section-title" />
                                
                                <Border BorderBrush="Transparent" CornerRadius="5" IsVisible="{Binding !OmniRigInited}" Background="DarkOrange" Padding="10">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20">
                                        <avalonia:MaterialIcon Kind="Warning" Width="20" Height="20"
                                                               VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,8,0" />
                                        <TextBlock 
                                            TextAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontWeight="Heavy"
                                            FontSize="14"
                                            Width="360"
                                            TextWrapping="Wrap"
                                            Text="{I18N {x:Static resources:LangKeys.omniinitfailed}}"></TextBlock>
                                    </StackPanel>
                                </Border>

                                <Grid ColumnDefinitions="*,2*,*"  IsVisible="{Binding OmniRigInited}"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ShowGridLines="False"
                                      RowSpacing="10">
                                    <!-- Polling -->
                                    <CheckBox Content="{I18N {x:Static resources:LangKeys.autoupdateriginfo}}"
                                              Grid.Column="0" Grid.ColumnSpan="2"
                                              IsChecked="{Binding DraftSettings.OmniRigSettings.PollAllowed}" />

                                    <!-- Poll Interval -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.pollinterval}}"
                                               Classes="setting-label"
                                               Grid.Row="1" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="1" Grid.Column="1"
                                             HorizontalAlignment="Left"
                                             MinWidth="20" Width="80"
                                             Text="{Binding DraftSettings.OmniRigSettings.PollInterval}" />

                                    <!-- Rig Model -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.targetrig}}"
                                               Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0" />
                                    <ComboBox Classes="setting-control" Grid.Row="2" Grid.Column="1"
                                              SelectedItem="{Binding DraftSettings.OmniRigSettings.SelectedRig}"
                                              ItemsSource="{x:Static resources:DefaultConfigs.OmniRigAvailableRig}" />
                                    
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.syncrigto}}"
                                               Grid.Row="3" Grid.Column="0"
                                               Classes="setting-label" />
                                    
                                    <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Spacing="12">
                                        <TextBox Classes="setting-control"
                                                 HorizontalAlignment="Left"
                                                 Width="200"
                                                 Text="{Binding DraftSettings.OmniRigSettings.SyncRigInfoAddress}"
                                                 Watermark="e.g. http://a.com/b;https://b.com/c" />
                                        
                                        <userControls1:TipIconUserControl TooltipText="{I18N {x:Static resources:LangKeys.spiltby}}" />
                                    </StackPanel>
                                    
                                    <userControls1:TestButtonUserControl Grid.Row="0" Grid.Column="2" Grid.RowSpan="4"
                                                                         DataContext="{Binding OmniRigTestButtonUserControl}" />
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- UDP Server Tab -->
            <TabItem Header="{I18N {x:Static resources:LangKeys.udpserver}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <Grid ColumnDefinitions="Auto,*"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="10">
                                    <!-- Enable UDP -->
                                    <CheckBox Content="{I18N {x:Static resources:LangKeys.enableudpserver}}"
                                              Grid.Column="0" Grid.ColumnSpan="2"
                                              IsChecked="{Binding DraftSettings.UDPSettings.EnableUDPServer}" />

                                    <!-- Outside Connections -->
                                    <CheckBox Content="{I18N {x:Static resources:LangKeys.enableoutsideconn}}"
                                              Grid.Column="1" Grid.Row="0"
                                              IsChecked="{Binding DraftSettings.UDPSettings.EnableConnectionFromOutside}" />

                                    <!-- Port -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.port}}" Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="2" Grid.Column="1"
                                             Text="{Binding DraftSettings.UDPSettings.UDPPort}" />

                                    <!-- Retry Count -->
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.qsoretrycount}}"
                                               Classes="setting-label" Grid.Row="4" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="4" Grid.Column="1"
                                             Text="{Binding DraftSettings.UDPSettings.RetryCount}" />

                                    <!-- UDP Forwarding -->
                                    <CheckBox Grid.Row="5" Grid.Column="0"
                                              Content="{I18N {x:Static resources:LangKeys.forwardmsg}}"
                                              Margin="0,10,0,0" x:Name="forwardudp"
                                              IsChecked="{Binding DraftSettings.UDPSettings.ForwardMessage}" />
                                    <TextBox Grid.Row="5" Grid.Column="1" Classes="setting-control" Margin="0,10,0,0"
                                             Text="{Binding DraftSettings.UDPSettings.ForwardAddress}"
                                             Watermark="e.g. 192.168.1.5:2237"
                                             IsEnabled="{Binding #forwardudp.IsChecked}" />

                                    <!-- TDP Forwarding -->
                                    <CheckBox Grid.Row="6" Grid.Column="0"
                                              Content="{I18N {x:Static resources:LangKeys.forward2tcp}}"
                                              Margin="0,10,0,0" x:Name="forwardtcp"
                                              IsChecked="{Binding DraftSettings.UDPSettings.ForwardMessageToHttp}" />
                                    <TextBox Grid.Row="6" Grid.Column="1" Classes="setting-control" Margin="0,10,0,0"
                                             Text="{Binding DraftSettings.UDPSettings.ForwardHttpAddress}"
                                             Watermark="e.g. http://domain/upload"
                                             IsEnabled="{Binding #forwardtcp.IsChecked}" />

                                    <!-- Notifications -->
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" Grid.Row="7"
                                                Grid.ColumnSpan="2" Margin="0,10,0,0">
                                        <TextBlock Text="{I18N {x:Static resources:LangKeys.pushnotificationon}}"
                                                   VerticalAlignment="Center" />
                                        <CheckBox Margin="30,0,0,0"
                                                  IsChecked="{Binding DraftSettings.UDPSettings.PushNotificationOnQSOMade}"
                                                  Content="{I18N {x:Static resources:LangKeys.qsofinished}}" />
                                        <CheckBox Margin="30,0,0,0"
                                                  IsChecked="{Binding DraftSettings.UDPSettings.PushNotificationOnQSOUploaded}"
                                                  Content="{I18N {x:Static resources:LangKeys.qsouploaded}}" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
           
            <!-- CLH Server Tab -->
            <TabItem Header="{I18N {x:Static resources:LangKeys.clhserver}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" Margin="0 8 0 0">
                        <Border Classes="setting-card">
                            <StackPanel Spacing="12">
                                <Grid ColumnDefinitions="*,2*,*" IsEnabled="False"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="10">
                                    
                                    <CheckBox Grid.Row="0" Grid.Column="0"
                                              IsChecked="{Binding DraftSettings.CLHServerSettings.CLHServerEnabled}"
                                              Content="{I18N {x:Static resources:LangKeys.enableclhserver}}"/> 

                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.clhseraddr}}" Classes="setting-label"
                                               Grid.Row="1" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="1" Grid.Column="1" 
                                             Text="{Binding DraftSettings.CLHServerSettings.ServerHost}"/>
                                    
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.clhserport}}" Classes="setting-label"
                                               Grid.Row="2" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="2" Grid.Column="1"
                                             Text="{Binding DraftSettings.CLHServerSettings.ServerPort}"/>
                                    
                                    <TextBlock Text="{I18N {x:Static resources:LangKeys.clhserkey}}" Classes="setting-label"
                                               Grid.Row="3" Grid.Column="0" />
                                    <TextBox Classes="setting-control" Grid.Row="3" Grid.Column="1"
                                             Text="{Binding DraftSettings.CLHServerSettings.ServerKey}"/>
                                    
                                    <CheckBox Classes="setting-control" 
                                              Content="{I18N {x:Static resources:LangKeys.clhusetls}}" 
                                              IsChecked="{Binding DraftSettings.CLHServerSettings.UseTLS}"
                                              Grid.Row="5" Grid.Column="0" />
                                    
                                    <userControls1:TestButtonUserControl Grid.Row="2" Grid.RowSpan="2" Grid.Column="2"
                                                                         DataContext="{Binding CLHServerTestButtonUserControl}" />
                                    
                                    <Border Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3" Classes="setting-card"
                                            MaxWidth="500"
                                            Background="{DynamicResource WarningBackground}">
                                        <Grid Margin="8" VerticalAlignment="Center" ColumnDefinitions="Auto,*">

                                            <avalonia:MaterialIcon Kind="InfoBox" 
                                                                   Width="20" Height="20"
                                                                   VerticalAlignment="Center"
                                                                   HorizontalAlignment="Center"
                                                                   Margin="0,0,8,0" />
        
                                            <TextBlock Grid.Column="1"
                                                       Text="{I18N {x:Static resources:LangKeys.clhhintinfo}}"
                                                       Classes="setting-label"
                                                       VerticalAlignment="Center"
                                                       TextWrapping="Wrap" />
                                        </Grid>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0 16 0 0">
            <Button Content="{I18N {x:Static resources:LangKeys.save}}" Classes="primary-action"
                    Command="{Binding SaveAndApplyConf}" />
            <Button Content="{I18N {x:Static resources:LangKeys.discard}}" Classes="secondary-action"
                    Command="{Binding DiscardConf}" />
        </StackPanel>
    </Grid>
</Window>